<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PRE-Client</title>

<style>
html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  background:#000;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
}

#box{
  text-align:center;
  display:none;
}

#text{
  font-size:22px;
  margin-bottom:16px;
}

#btn{
  padding:12px 24px;
  font-size:16px;
  border-radius:8px;
  border:none;
  background:#fff;
  color:#000;
}
</style>
</head>

<body>

<div id="box">
  <div id="text">Đợi 1 chút !!!</div>
  <button id="btn" disabled>Quay lại TikTok</button>
</div>

<script>
// ================= CONFIG =================
const shopeeCode = "5fhxCr0NIv";
const shopeeUrl  = `https://s.shopee.vn/${shopeeCode}`;
const tiktokAffUrl = "https://www.tiktok.com/view/product/1731135272913242730?_svg=1&chain_key=%7B%22t%22%3A1%2C%22k%22%3A%22000000000000000007578535186801231623%22%2C%22sc%22%3A%22copy%22%7D&encode_params=MIIBUwQMZxaZLEzlwtU0KQOKBIIBLweDAovBiNUL-AhvADiqKLBHQAn-VMzIGuMGWkNoGw4HwX5cxZ3YUMxn3bdOuf-L0LrYfyOK4tGC11gE9ld_ZeslwQxWYRDW4SAnlUT9UJHqFn_e8oTtWnmreKgkBAP2jge6U3q-PIONmfS0vKrplg0vfL7x5w5owjO_X7eIzAZUd-5THo1IxuFcksq51RckHreVAxc4LVRYFZjcRWeCswv9n7bRLryOsK_D91Zitwpz8kz-XX3j4GtCOQvq1V5i2sv-nRiBfomElFa9Ln4I5eLoaHXxhtKtYxjXc4CVQO1_esvCfqD13mf6uyhtQZcMxvZ8UVyQlbTm8JwjxCUnKIYRR9RVwprSI9FDLgQ1FT6rKu_QKkRIhBCUJkHQlILnIlW8t_axdY11AcIu_AbNMwQQFe0XkHCnaZ7iHGjaaJ4aGg%3D%3D&scene=pdp&share_app_id=1180&share_region=VN&timestamp=1764515245&trackParams=%7B%22enter_from_info%22%3A%22product_share_outside%22%2C%22source_page_type%22%3A%22product_share%22%2C%22enable_shop_tab_popup%22%3A1%7D&use_land_page=1&utm_campaign=client_share&utm_source=copy";

// Android intents
const androidIntent = `intent://s.shopee.vn/${shopeeCode}#Intent;scheme=https;package=com.shopee.vn;end`;
const chromeNavigate = `googlechrome://navigate?url=${encodeURIComponent(shopeeUrl)}`;
const chromeIntent = `intent://s.shopee.vn/${shopeeCode}#Intent;package=com.android.chrome;scheme=https;S.browser_fallback_url=${encodeURIComponent(shopeeUrl)};end`;

// ================= STATE =================
let shopeeFired = false;
let resumeTime = 0;

// ================= DEVICE =================
const ua = navigator.userAgent.toLowerCase();
const isIOS = /iphone|ipad|ipod/.test(ua);

// ================= SHOPEE =================
function openShopee(){
  if(shopeeFired) return;
  shopeeFired = true;

  if(isIOS){
    location.replace(shopeeUrl);
    return;
  }

  try{
    const iframe=document.createElement("iframe");
    iframe.style.display="none";
    iframe.src=androidIntent;
    document.body.appendChild(iframe);
  }catch(e){}

  try{ window.open(androidIntent,"_blank"); }catch(e){}

  setTimeout(()=>location.href=androidIntent, 5);
  setTimeout(()=>location.href=chromeNavigate, 40);
  setTimeout(()=>location.href=chromeIntent, 90);
  setTimeout(()=>location.replace(shopeeUrl), 1400);
}

// ================= RESUME =================
document.addEventListener("visibilitychange", ()=>{
  if(document.visibilityState === "visible" && shopeeFired){
    resumeTime = Date.now();
    document.getElementById("box").style.display="block";

    // Mở nút sau 3s để Shopee chốt session
    setTimeout(()=>{
      document.getElementById("btn").disabled = false;
    }, 3000);
  }
});

// ================= BTN =================
document.getElementById("btn").onclick = ()=>{
  location.replace(tiktokAffUrl);
};

// ================= RUN =================
document.addEventListener("DOMContentLoaded", ()=>{
  setTimeout(openShopee, 10);
});
</script>

</body>
</html>
